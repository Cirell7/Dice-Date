{% extends "core/base1.html" %}
{% load static %}

{% block extra_style %}
  <link rel="stylesheet" href="{% static 'pages/css/homepage/post_list.css' %}" />
  <link rel="stylesheet" href="{% static 'pages/css/homepage/button_post.css' %}" />
{% endblock %}

{% block extra_scripts %}
  <script src="https://api-maps.yandex.ru/2.1/?apikey=–í–ê–®_API_–ö–õ–Æ–ß&lang=ru_RU" type="text/javascript"></script>
  <script src="{% static 'js/post_list_map.js' %}"></script>
  {% endblock %}

{% block main %}
<div class="container">
    <h1>–í—Å–µ –≤—Å—Ç—Ä–µ—á–∏</h1>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã -->
    <div class="map-section mb-4">
        <h3>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –≤—Å—Ç—Ä–µ—á</h3>
        <div id="posts-map" style="width: 100%; height: 400px; border-radius: 12px; margin-bottom: 20px;"></div>
    </div>
    
    {% for post in posts %}
    <div class="post-card mb-4 p-4 border rounded" data-post-id="{{ post.id }}" 
        data-post-name="{{ post.name }}" 
        data-post-address="{{ post.address }}"
        data-post-url="{% url 'post_detail' post.id %}"
        {% if post.latitude and post.longitude %}
        data-lat="{{ post.latitude }}"
        data-lng="{{ post.longitude }}"
        {% endif %}>
        <div class="post-header">
            <div class="author-info">
                <!-- –§–æ—Ç–æ –∞–≤—Ç–æ—Ä–∞ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ) -->
                <a href="{% url 'profile_view' user_id=post.user.id %}" class="author-photo-link">
                    {% if post.user.profile.photo %}
                        <img src="{{ post.user.profile.photo.url }}" class="author-photo" alt="{{ post.user.username }}">
                    {% else %}
                        <div class="author-photo default-avatar">{{ post.user.username|first|upper }}</div>
                    {% endif %}
                </a>
                <div class="author-details">
                    <h2><a href="{% url 'post_detail' post.id %}">{{ post.name }}</a></h2>
                    <p>
                        <strong>–ê–≤—Ç–æ—Ä:</strong> 
                        <a href="{% url 'profile_view' user_id=post.user.id %}" class="author-link">
                            {{ post.user.username }}
                        </a>
                    </p>
                </div>
            </div>
            <p><strong>–ö–æ–≥–¥–∞:</strong> {{ post.expiration_date|date:"d.m.Y H:i" }}</p>
            <p><strong>–ì–¥–µ:</strong> {{ post.address }}</p>
            <p><strong>–ú–∞–∫—Å–∏–º—É–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong> {{ post.max_participants }}</p>
        </div>
        
        <div class="post-description">
            <p>{{ post.description }}</p>
        </div>
        
        {% if post.image %}
        <div class="post-image">
            <img src="{{ post.image.url }}" class="img-fluid" style="max-height: 300px;" />
        </div>
        {% endif %}
        
        <div class="post-footer">
            <span class="comment-count">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: {{ post.comments.count }}</span>
            <div class="action-buttons">
                <a href="{% url 'post_detail' post.id %}" class="btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                <button type="button" class="btn-outline-secondary show-on-map" 
                        data-post-id="{{ post.id }}">
                    üìç –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                </button>
            </div>
        </div>
    </div>
    {% empty %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á. <a href="{% url 'add_post' %}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</a></p>
    {% endfor %}
</div>

<script>

</script>

{% endblock %}