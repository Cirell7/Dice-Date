{% extends "core/base1.html" %}
{% load static %}

{% block extra_style %}
  <link rel="stylesheet" href="{% static 'pages/css/homepage/post_requests.css' %}" />
{% endblock %}

{% block title %}–ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ - {{ post.name }}{% endblock %}

{% block main %}
<div class="post-detail-container">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞ -->
    <div class="author-details">
        <h2><a href="{% url 'post_detail' post.id %}">{{ post.name }}</a></h2>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="requests-stats">
    <div class="stat-item">
      <span class="stat-label">–¢–µ–∫—É—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏:</span>
      <span class="stat-value">{{ post.participants.count }}/{{ post.max_participants }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">–û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏:</span>
      <span class="stat-value">{{ pending_requests|length }}</span>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
  <div class="requests-section">
    <h3>üë• –¢–µ–∫—É—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ ({{ post.participants.count }})</h3>
    
    {% if post.participants.all %}
      <div class="requests-list">
        {% for participant in post.participants.all %}
        <div class="request-item">
          <div class="request-user-info">
            <a href="{% url 'profile_view' user_id=participant.user.id %}" class="user-link">
              {% if participant.user.profile.photo %}
                <img src="{{ participant.user.profile.photo.url }}" class="user-avatar" alt="{{ participant.user.username }}">
              {% else %}
                <div class="user-avatar default-avatar">{{ participant.user.username|first|upper }}</div>
              {% endif %}
              <div class="user-details">
                <strong>{{ participant.user.username }}</strong>
                <span class="request-date">
                  {% if participant.user == post.user %}
                    üëë –ê–≤—Ç–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                  {% else %}
                    –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è: {{ participant.joined_at|date:"d.m.Y H:i" }}
                  {% endif %}
                </span>
              </div>
            </a>
          </div>
          
          <div class="request-actions">
            {% if participant.user != post.user %}
            <form method="post" action="" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-remove" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞?')">
                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
              </button>
            </form>
            {% else %}
            <div class="author-badge">
              üëë –ê–≤—Ç–æ—Ä
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-requests">
        <p>üòî –ü–æ–∫–∞ –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
      </div>
    {% endif %}
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
  <div class="requests-section">
    <h3>üìã –ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ ({{ pending_requests|length }})</h3>
    
    {% if pending_requests %}
      <div class="requests-list">
        {% for request in pending_requests %}
        <div class="request-item">
          <div class="request-user-info">
            <a href="{% url 'profile_view' user_id=request.user.id %}" class="user-link">
              {% if request.user.profile.photo %}
                <img src="{{ request.user.profile.photo.url }}" class="user-avatar" alt="{{ request.user.username }}">
              {% else %}
                <div class="user-avatar default-avatar">{{ request.user.username|first|upper }}</div>
              {% endif %}
              <div class="user-details">
                <strong>{{ request.user.username }}</strong>
                <span class="request-date">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: {{ request.created_at|date:"d.m.Y H:i" }}</span>
              </div>
            </a>
          </div>
          
          <div class="request-actions">
            <form method="post" action="{% url 'approve_request' post.id request.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-approve" 
                      {% if post.participants.count >= post.max_participants %}disabled{% endif %}>
                ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
              </button>
            </form>
            
            <form method="post" action="{% url 'reject_request' post.id request.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-reject">
                ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-requests">
        <p>üéâ –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ —É—á–∞—Å—Ç–∏–µ!</p>
      </div>
    {% endif %}
  </div>

  <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
  <div class="action-buttons">
    <a href="{% url 'post_detail' post.id %}" class="btn-back">
      ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ—Å—Ç—É
    </a>
  </div>
</div>
{% endblock %}