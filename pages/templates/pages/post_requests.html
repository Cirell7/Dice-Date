{% extends "core/base1.html" %}
{% load static %}

{% block extra_style %}
  <link rel="stylesheet" href="{% static 'pages/css/homepage/post_requests.css' %}" />
{% endblock %}

{% block title %}–ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ - {{ post.name }}{% endblock %}

{% block main %}

<div class="form-container">
  <div class="form-content">
    <div class="form-header">
      <button class="back-btn" onclick="window.history.back()">‚Üê –ù–∞–∑–∞–¥</button>
      <h3>–ó–∞—è–≤–∫–∏</h3>
      </div>

  <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
  <div class="requests-section">
    <p> –¢–µ–∫—É—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ {{ post.participants.count }}/{{ post.max_participants }}</p>
    
    {% if post.participants.all %}
      <div class="requests-list">
        {% for participant in post.participants.all %}
        <div class="request-item">
          <div class="comment-author-block">
              <a href="{% url 'profile_view' user_id=participant.user.id %}" class="author-link">
                  {% if participant.user.profile.photo %}
                      <img src="{{ participant.user.profile.photo.url }}" class="comment-avatar-img" alt="{{ participant.user.username }}">
                  {% else %}
                      <div class="comment-avatar-default">{{ participant.user.username|first|upper }}</div>
                  {% endif %}
              </a>
              <div class="comment-author-info">
                  <a href="{% url 'profile_view' user_id=participant.user.id %}" class="author-link">
                      {{ participant.user.username }}
                  </a>
                  <span class="comment-date">
                      {% if participant.user == post.user %}
                          üëë –ê–≤—Ç–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                      {% else %}
                          –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è: {{ participant.joined_at|date:"d.m.Y H:i" }}
                      {% endif %}
                  </span>
              </div>
          </div>
          
          <div class="request-actions">
            {% if participant.user != post.user %}
            <form method="post" action="" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-primary" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞?')">
                üóëÔ∏è
              </button>
            </form>
            {% else %}
            <div class="author-badge">
              üëë –ê–≤—Ç–æ—Ä
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-requests">
      </div>
    {% endif %}
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
  <div class="requests-section">
    <p> –ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ ({{ pending_requests|length }})</p>
    
    {% if pending_requests %}
    <div class="requests-list">
      {% for request in pending_requests %}
      <div class="request-item">
          <div class="comment-author-block">
              <a href="{% url 'profile_view' user_id=request.user.id %}" class="author-link">
                  {% if request.user.profile.photo %}
                      <img src="{{ request.user.profile.photo.url }}" class="comment-avatar-img" alt="{{ request.user.username }}">
                  {% else %}
                      <div class="comment-avatar-default">{{ request.user.username|first|upper }}</div>
                  {% endif %}
              </a>
              <div class="comment-author-info">
                  <a href="{% url 'profile_view' user_id=request.user.id %}" class="author-link">
                      {{ request.user.username }}
                  </a>
                  <span class="comment-date">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: {{ request.created_at|date:"d.m.Y H:i" }}</span>
              </div>
          </div>
          
          <div class="request-actions">
            <form method="post" action="{% url 'approve_request' post.id request.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-join" 
                      {% if post.participants.count >= post.max_participants %}disabled{% endif %}>
                ‚úÖ
              </button>
            </form>
            
            <form method="post" action="{% url 'reject_request' post.id request.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-primary">
                ‚ùå
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-requests">
      </div>
    {% endif %}
  </div>
</div>
</div>
{% endblock %}