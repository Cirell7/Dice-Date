{% extends "core/base1.html" %}
{% load static %}

{% block extra_style %}
  <link rel="stylesheet" href="{% static 'pages/css/homepage/post_requests.css' %}" />
{% endblock %}

{% block title %}–ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ - {{ post.name }}{% endblock %}

{% block main %}
<div class="post-detail-container">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞ -->
  <div class="author-info">
    <a href="{% url 'profile_view' user_id=post.user.id %}" class="author-photo-link">
        {% if post.user.profile.photo %}
            <img src="{{ post.user.profile.photo.url }}" class="author-photo" alt="{{ post.user.username }}">
        {% else %}
            <div class="author-photo default-avatar">{{ post.user.username|first|upper }}</div>
        {% endif %}
    </a>
    <div class="author-details">
        <h2><a href="{% url 'post_detail' post.id %}">{{ post.name }}</a></h2>
        <strong>–ê–≤—Ç–æ—Ä:</strong> 
        <a href="{% url 'profile_view' user_id=post.user.id %}" class="author-link">
            {{ post.user.username }}
        </a>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="requests-stats">
    <div class="stat-item">
      <span class="stat-label">–¢–µ–∫—É—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏:</span>
      <span class="stat-value">{{ post.participants.count }}/{{ post.max_participants }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">–û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏:</span>
      <span class="stat-value">{{ pending_requests|length }}</span>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
  <div class="requests-section">
    <h3>üìã –ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ</h3>
    
    {% if pending_requests %}
      <div class="requests-list">
        {% for request in pending_requests %}
        <div class="request-item">
          <div class="request-user-info">
            <a href="{% url 'profile_view' user_id=request.user.id %}" class="user-link">
              {% if request.user.profile.photo %}
                <img src="{{ request.user.profile.photo.url }}" class="user-avatar" alt="{{ request.user.username }}">
              {% else %}
                <div class="user-avatar default-avatar">{{ request.user.username|first|upper }}</div>
              {% endif %}
              <div class="user-details">
                <strong>{{ request.user.username }}</strong>
                <span class="request-date">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: {{ request.created_at|date:"d.m.Y H:i" }}</span>
              </div>
            </a>
          </div>
          
          <div class="request-actions">
            <form method="post" action="{% url 'approve_request' post.id request.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-approve" 
                      {% if post.participants.count >= post.max_participants %}disabled{% endif %}>
                ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
              </button>
            </form>
            
            <form method="post" action="{% url 'reject_request' post.id request.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn-reject">
                ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-requests">
        <p>üéâ –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ —É—á–∞—Å—Ç–∏–µ!</p>
      </div>
    {% endif %}
  </div>

  <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
  <div class="action-buttons">
    <a href="{% url 'post_detail' post.id %}" class="btn-back">
      ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ—Å—Ç—É
    </a>
  </div>
</div>
{% endblock %}