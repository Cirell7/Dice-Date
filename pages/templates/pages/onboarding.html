{% extends 'pages/profile.html' %}
{% load static %}

{% block extra_style %}
<link rel="stylesheet" href="{% static 'css/dice_date/onboarding.css'%}">
{% endblock %}

{% block main %}
{{ block.super }} 
<div class="onboarding-overlay">
    <div class="modal-content">
        <a href="#" class="close-btn" onclick="closeOnboarding(); return false;">√ó</a>
        
        <div class="onboarding-header">
            <h2>–û –≤–∞—Å</h2>
            <p>–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–∞–º –æ —Å–µ–±–µ, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –≤–∞—à –æ–ø—ã—Ç</p>
        </div>
        
        <form id="onboarding-form">
            {% csrf_token %}
            
            <div class="gender-selection">
                <div class="gender-option">
                    <input type="radio" id="female" name="gender" value="female" required>
                    <label for="female" class="gender-card">
                        <span>üë©</span>
                        <span>–ñ–µ–Ω—â–∏–Ω–∞</span>
                    </label>
                </div>
                
                <div class="gender-option">
                    <input type="radio" id="male" name="gender" value="male" required>
                    <label for="male" class="gender-card">
                        <span>üë®</span>
                        <span>–ú—É–∂—á–∏–Ω–∞</span>
                    </label>
                </div>
                
                <div class="gender-option">
                    <input type="radio" id="prefer-not-to-say" name="gender" value="prefer-not-to-say" required>
                    <label for="prefer-not-to-say" class="gender-card">
                        <span>üôÇ</span>
                        <span>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç—å</span>
                    </label>
                </div>
            </div>
    
            <div class="form-section">
                <h3>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</h3>
                <div class="birth-date-container">
                    <input type="date" name="birth_date" id="birth_date" class="birth-date-input" required>
                    <small class="birth-date-hint">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è</small>
                </div>
            </div>

            <div class="action-buttons">
                <button type="button" class="btn-secondary" onclick="closeOnboarding()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
                <button type="button" class="btn-primary" onclick="saveOnboarding()" id="submit-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<script>
function closeOnboarding() {
    document.querySelector('.onboarding-overlay').style.display = 'none';
    window.location.href = "{% url 'profile' %}";
}

function saveOnboarding() {
    const selectedGender = document.querySelector('input[name="gender"]:checked');
    const birthDate = document.getElementById('birth_date').value;
    const submitBtn = document.getElementById('submit-btn');
    
    // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    if (!selectedGender) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø–æ–ª');
        return;
    }
    
    if (!birthDate) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è');
        return;
    }

    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    submitBtn.disabled = true;
    submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
    
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const formData = new FormData();
    formData.append('gender', selectedGender.value);
    formData.append('birth_date', birthDate);  // –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ birth_date
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    fetch("", {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            window.location.href = "{% url 'profile' %}";
        } else {
            throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
        submitBtn.disabled = false;
        submitBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
    });
}
</script>
{% endblock %}