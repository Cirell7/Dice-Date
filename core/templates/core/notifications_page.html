{% extends "core/base1.html" %}
{% load static %}

{% block extra_style %}
<link rel="stylesheet" href="{% static 'core/css/base/notifications_page.css' %}" />
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'core/js/notifications_page.js' %}"defer></script>
{%endblock%}

{% block main %}

<div class="form-container">
    <div class="form-content">
        <div class="form-header">
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            {% if unread_notifications_count > 0 %}
            <button onclick="markAllAsRead()" class="btn-primary">
                üì¨ –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ
            </button>
            {% endif %}
        </div>

        <div class="notifications-list">
            {% if notifications %}
                {% for notification in notifications %}
                <div class="notification-item {% if not notification.is_read %}unread{% endif %}" 
                     data-notification-id="{{ notification.id }}"
                     onclick="markAsReadAndNavigate({{ notification.id }})">
                    <div class="notification-content">
                        {% if notification.notification_type == 'event_completed' and notification.post %}
                            {# –î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è #}
                            {% if notification.user == notification.post.user %}
                                {# –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ #}
                                {% with first_participant=notification.post.participants.first %}
                                    {% if first_participant %}
                                        <a href="{% url 'rate_participant' notification.post.id first_participant.user.id %}">
                                            {{ notification.message }} (–æ—Ü–µ–Ω–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)
                                        </a>
                                    {% else %}
                                        <div class="notification-text">{{ notification.message }}</div>
                                    {% endif %}
                                {% endwith %}
                            {% else %}
                                {# –£—á–∞—Å—Ç–Ω–∏–∫ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ #}
                                <a href="{% url 'rate_participant' notification.post.id notification.post.user.id %}">
                                    {{ notification.message }} (–æ—Ü–µ–Ω–∏—Ç–µ –≤—Å—Ç—Ä–µ—á—É)
                                </a>
                            {% endif %}
                        {% else %}
                            {# –í—Å–µ –¥—Ä—É–≥–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è #}
                            <div class="notification-text">{{ notification.message }}</div>
                        {% endif %}
                        <div class="notification-time">{{ notification.created_at|timesince }} –Ω–∞–∑–∞–¥</div>
                    </div>
                    {% if not notification.is_read %}
                    <div class="unread-dot"></div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="no-messages" style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; height: 200px;">
                    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
                    <a href="{% url 'post_list' %}" class="btn btn-primary">–ù–∞–π—Ç–∏ –≤—Å—Ç—Ä–µ—á–∏</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}